# IAC Automation for AKS to access ACR 

## Change from Service Principal to Managed Identity with terraform or AZ-cli for an AKS (Azure Kubernetes Service) using ACR (Azure Container Registry)


### Managed Identity

First of all we need to understand Managed Identity.

Is a secure and automated way to manage and authenticate identities for resources in Azure. Managed Identity eliminates the need for developers to manage credentials manually, which can help reduce the risk of security breaches and simplify the development process.

### Managed Identity with AKS

Then we need to understand managed identity in AKS.

When you enable Managed Identity for an AKS cluster, it generates **two identities**: one for the cluster itself, and one for the nodes that make up the cluster.

The two identities generated by AKS Managed Identity are:

**Control Plane Managed Identity**: This is a Kubernetes service account that's created in the namespace where your AKS cluster is running. The service account is associated with the Azure Active Directory (AAD) identity of the AKS cluster, and it can be used to access Azure resources such as storage accounts, Key Vault, and Azure AD.

**Kubelet Managed Identity**: This is a Managed Identity that's created for each node in the AKS cluster. The identity is used to authenticate with Azure resources that the node needs to access, such as storage accounts or Azure Container Registry (ACR).

### Managed Identity with AKS and ACR

> For our scenario we need to make sure The Kubelet Identity has the right permissions to access ACR






